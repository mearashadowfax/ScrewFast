---
// Import necessary components, modules and types
import MainLayout from "@/layouts/MainLayout.astro";
import CardBlog from "@components/ui/cards/CardBlog.astro";
import CardBlogRecent from "@components/ui/cards/CardBlogRecent.astro";
import CardInsight from "@components/ui/cards/CardInsight.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { SITE } from "@data/constants";

// Get all blogs post in French and sort them based on publish date

const frenchBlogEntries = await getCollection("blog", ({ id }) => {
  return id.startsWith("vn/");
});

const frenchInsightsEntries = await getCollection("insights", ({ id }) => {
  return id.startsWith("vn/");
});

const blogPosts: CollectionEntry<"blog">[] = frenchBlogEntries.sort(
  (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
    b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
// Get all insights posts
const insightPosts: CollectionEntry<"insights">[] = frenchInsightsEntries;

// Separate the most recent post from others
const mostRecentPost: CollectionEntry<"blog"> = blogPosts[0];
const otherPosts: CollectionEntry<"blog">[] = blogPosts.slice(1);

// Define variables for page content
const title: string = "Cánh cổng dẫn tới sự xuất sắc trong xây dựng";
const subTitle: string =
  "Khám phá những tin tức mới nhất, mẹo hữu ích và phân tích chuyên sâu từ ScrewFast nhằm nâng cao hiệu quả cho các dự án xây dựng của bạn. Từ giới thiệu sản phẩm đến chiến lược quản lý dự án, blog của chúng tôi là nguồn tài nguyên không thể thiếu cho mọi vấn đề liên quan đến công cụ và xây dựng.";
const secondTitle: string = "Góc nhìn chuyên sâu";
const secondSubTitle: string =
  "Luôn cập nhật các xu hướng và thay đổi mới nhất trong ngành xây dựng thông qua những phân tích đến từ đội ngũ chuyên gia của ScrewFast.";

const pageTitle: string = `Blog | ${SITE.title}`;
const metaDescription =
  "Luôn cập nhật những xu hướng và biến chuyển mới nhất trong ngành xây dựng với các phân tích từ đội ngũ chuyên gia của ScrewFast.";
const ogTitle = "Blog ngành xây dựng | ScrewFast";
---

<MainLayout
  lang="vn"
  title={pageTitle}
  customDescription={metaDescription}
  customOgTitle={ogTitle}
  structuredData={{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "@id": "https://screwfast.uk/vn/blog",
    url: "https://screwfast.uk/vn/blog",
    name: "Blog | ScrewFast",
    description:
      "Luôn cập nhật những xu hướng và biến chuyển mới nhất trong ngành xây dựng với các phân tích từ đội ngũ chuyên gia của ScrewFast.",
    isPartOf: {
      "@type": "WebSite",
      url: "https://screwfast.uk/vn",
      name: "ScrewFast",
      description:
        "ScrewFast cung cấp các công cụ phần cứng hàng đầu cùng dịch vụ xây dựng chuyên nghiệp nhằm đáp ứng mọi nhu cầu dự án của bạn.",
    },
    inLanguage: "vn",
  }}
>
  <section
    class="mx-auto max-w-[85rem] space-y-8 px-4 pt-16 sm:px-6 lg:px-8 2xl:max-w-full"
  >
    <!--Page header-->
    <div class="mx-auto max-w-3xl text-left sm:text-center">
      <h1
        class="block text-4xl font-bold tracking-tight text-balance text-neutral-800 md:text-5xl lg:text-6xl dark:text-neutral-200"
      >
        {title}
      </h1>

      <p
        class="mt-4 text-lg text-pretty text-neutral-600 dark:text-neutral-400"
      >
        {subTitle}
      </p>
    </div>
  </section>

  <section
    class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
  >
    {/* Blog posts grid */}
    <div class="grid gap-6 lg:grid-cols-2">
      {
        otherPosts.map((blogEntry) => (
          <CardBlog blogEntry={blogEntry} blogLocale="vn" />
        ))
      }
    </div>
  </section>
  {/* Most recent blog post */}
  {mostRecentPost && (
  <section
    class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
  >
    <CardBlogRecent blogEntry={mostRecentPost} recentBlogLocale="vn" />
  </section>
  )}
  {/* Insights section */}
  <section
    class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
  >
    <div class="mx-auto mb-10 max-w-2xl text-center lg:mb-14">
      <h2
        class="text-2xl font-bold text-neutral-800 md:text-4xl md:leading-tight dark:text-neutral-200"
      >
        {secondTitle}
      </h2>
      <p class="mt-1 text-pretty text-neutral-600 dark:text-neutral-400">
        {secondSubTitle}
      </p>
    </div>
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {
        insightPosts.map((insightEntry) => (
          <CardInsight insightEntry={insightEntry} insightLocale="vn" />
        ))
      }
    </div>
  </section>
</MainLayout>
